---
/**
 * Example: Category Filter Component
 *
 * This demonstrates how to use the geoquery library to filter POIs by category.
 * To use this component, import it in index.astro:
 *
 * import FilterExample from '../components/FilterExample.astro';
 * <FilterExample />
 */
---

<div class="filter-panel">
	<h3>Filter by Category</h3>
	<div id="category-filters" class="filter-grid">
		<!-- Filters will be populated dynamically -->
	</div>
	<button id="show-all" class="filter-btn">Show All</button>
</div>

<script type="module">
	import geoquery from '/src/lib/geoquery.js';

	// This would be called after geoData is loaded
	window.initCategoryFilters = function(geoData, onFilterChange) {
		const container = document.getElementById('category-filters');
		const showAllBtn = document.getElementById('show-all');

		// Get all unique categories
		const categories = geoquery.getAllCategories(geoData);

		// Create filter checkboxes
		categories.forEach(category => {
			const label = document.createElement('label');
			label.className = 'category-filter';

			const checkbox = document.createElement('input');
			checkbox.type = 'checkbox';
			checkbox.value = category;
			checkbox.checked = true;

			const span = document.createElement('span');
			span.textContent = category;

			label.appendChild(checkbox);
			label.appendChild(span);
			container.appendChild(label);

			// Handle filter change
			checkbox.addEventListener('change', () => {
				const selectedCategories = Array.from(
					container.querySelectorAll('input[type="checkbox"]:checked')
				).map(cb => cb.value);

				onFilterChange(selectedCategories);
			});
		});

		// Show all button
		showAllBtn.addEventListener('click', () => {
			container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
				cb.checked = true;
			});
			onFilterChange(categories);
		});
	};

	// Example filter function using spatial queries
	window.filterPOIsByCategories = async function(geoData, graetzlId, selectedCategories) {
		const graetzlData = await geoquery.loadGraetzlData();
		return geoquery.filterPOIsWithGraetzl(geoData, graetzlData, {
			graetzlId: graetzlId,
			categories: selectedCategories
		});
	};
</script>

<style>
	.filter-panel {
		padding: 1rem;
		background: white;
		border-radius: 8px;
		box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		margin-bottom: 1rem;
	}

	.filter-panel h3 {
		font-size: 0.9rem;
		font-weight: 600;
		margin-bottom: 0.75rem;
		color: #666;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}

	.filter-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
		gap: 0.5rem;
		margin-bottom: 1rem;
	}

	.category-filter {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		cursor: pointer;
		padding: 0.5rem;
		border-radius: 4px;
		transition: background 0.2s;
	}

	.category-filter:hover {
		background: #f5f5f5;
	}

	.category-filter input[type="checkbox"] {
		cursor: pointer;
	}

	.category-filter span {
		font-size: 0.875rem;
		text-transform: capitalize;
	}

	.filter-btn {
		width: 100%;
		padding: 0.75rem;
		background: #667eea;
		color: white;
		border: none;
		border-radius: 6px;
		font-weight: 500;
		cursor: pointer;
		transition: background 0.2s;
	}

	.filter-btn:hover {
		background: #5568d3;
	}
</style>
